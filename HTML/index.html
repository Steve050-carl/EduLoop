<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduLoop Lite - School-Parent Communication Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#f59e0b',
                        success: '#10b981',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .notification { animation: slideInRight 0.3s ease-out; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .auth-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Authentication Screen -->
    <div id="authScreen" class="min-h-screen auth-bg flex items-center justify-center px-4">
        <div class="max-w-md w-full">
            <!-- Login Form -->
            <div id="loginForm" class="bg-white rounded-lg shadow-xl p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">ðŸ“š EduLoop Lite</h1>
                    <p class="text-gray-600">School-Parent Communication Platform</p>
                </div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                        <input type="email" id="loginEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter your password" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Login As</label>
                        <select id="loginRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="admin">School Admin</option>
                            <option value="teacher">Teacher</option>
                            <option value="parent">Parent</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        Sign In
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <p class="text-gray-600">Don't have an account? 
                        <button onclick="showSignupForm()" class="text-primary hover:text-blue-700 font-medium">Create Account</button>
                    </p>
                </div>
                
                <!-- Demo Credentials -->
                <div class="mt-8 p-4 bg-blue-50 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2">Demo Credentials:</h4>
                    <div class="text-sm text-gray-600 space-y-1">
                        <p><strong>Admin:</strong> admin@school.com / admin123</p>
                        <p><strong>Teacher:</strong> teacher@school.com / teacher123</p>
                        <p><strong>Parent:</strong> parent@school.com / parent123</p>
                        <p class="mt-2 text-xs"><strong>Demo School Code:</strong> SCH001</p>
                    </div>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="bg-white rounded-lg shadow-xl p-8 hidden">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Account</h1>
                    <p class="text-gray-600">Join EduLoop Lite Platform</p>
                </div>
                
                <form onsubmit="handleSignup(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                        <select id="signupRole" onchange="toggleRoleFields()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="admin">School Admin</option>
                            <option value="teacher">Teacher</option>
                            <option value="parent">Parent</option>
                        </select>
                    </div>
                    
                    <!-- Admin Registration Fields -->
                    <div id="adminFields" class="space-y-4 mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                <input type="text" id="adminFirstName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                <input type="text" id="adminLastName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Personal Email</label>
                            <input type="email" id="adminEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="adminPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="+254..." required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                            <input type="text" id="schoolName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School Email</label>
                            <input type="email" id="schoolEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Postal Address</label>
                            <input type="text" id="schoolPostalAddress" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="P.O. Box 123, City" required>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">County</label>
                                <select id="schoolCounty" onchange="loadSubcounties()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                    <option value="">Select County</option>
                                    <option value="Nairobi">Nairobi</option>
                                    <option value="Mombasa">Mombasa</option>
                                    <option value="Kiambu">Kiambu</option>
                                    <option value="Nakuru">Nakuru</option>
                                    <option value="Kisumu">Kisumu</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Subcounty</label>
                                <select id="schoolSubcounty" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                    <option value="">Select Subcounty</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Teacher Registration Fields -->
                    <div id="teacherFields" class="space-y-4 mb-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="teacherFullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="teacherEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="teacherPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="+254...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                            <input type="text" id="teacherSchoolName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School Code</label>
                            <input type="text" id="teacherSchoolCode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter school code provided by admin">
                        </div>
                    </div>
                    
                    <!-- Parent Registration Fields -->
                    <div id="parentFields" class="space-y-4 mb-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="parentFullName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="parentPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="+254...">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School Name</label>
                            <input type="text" id="parentSchoolName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">School Code</label>
                            <input type="text" id="parentSchoolCode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter school code provided by admin">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Student Name</label>
                            <input type="text" id="parentStudentName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Student Registration Number</label>
                            <input type="text" id="parentRegistrationNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Student Class</label>
                            <select id="parentStudentClass" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="">Select Class</option>
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                                <option value="Grade 6">Grade 6</option>
                                <option value="Grade 7">Grade 7</option>
                                <option value="Grade 8">Grade 8</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="signupPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" minlength="6" required>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" required>
                    </div>
                    
                    <button type="submit" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        Create Account
                    </button>
                </form>
                
                <div class="mt-6 text-center">
                    <p class="text-gray-600">Already have an account? 
                        <button onclick="showLoginForm()" class="text-primary hover:text-blue-700 font-medium">Sign In</button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application (Hidden initially) -->
    <div id="mainApp" class="hidden">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg border-b-2 border-primary">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <h1 class="text-2xl font-bold text-primary">ðŸ“š EduLoop Lite</h1>
                        </div>
                        <div class="hidden md:block ml-10">
                            <div class="flex items-baseline space-x-4" id="navMenu">
                                <!-- Navigation items will be populated based on user role -->
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <select id="languageSelect" onchange="toggleLanguage()" class="bg-white border border-gray-300 rounded-md px-3 py-1 text-sm">
                            <option value="en">English</option>
                            <option value="sw">Kiswahili</option>
                        </select>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600" id="userInfo">Welcome!</span>
                            <div id="userAvatar" class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-bold">U</div>
                            <button onclick="logout()" class="text-sm text-gray-600 hover:text-gray-800 ml-2">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mobile menu -->
            <div class="md:hidden">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-gray-50" id="mobileNavMenu">
                    <!-- Mobile navigation items will be populated based on user role -->
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Dashboard" data-sw="Dashibodi">Dashboard</h2>
                    <p class="text-gray-600" id="dashboardWelcome" data-en="Welcome to EduLoop Lite" data-sw="Karibu EduLoop Lite">Welcome to EduLoop Lite</p>
                </div>

                <!-- Role-specific dashboard content will be loaded here -->
                <div id="dashboardContent">
                    <!-- Content will be populated based on user role -->
                </div>
            </div>

            <!-- Students Section (Admin/Teacher only) -->
            <div id="students" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Student Management" data-sw="Usimamizi wa Wanafunzi">Student Management</h2>
                    <p class="text-gray-600" data-en="Manage student records and class assignments" data-sw="Simamia rekodi za wanafunzi na madarasa">Manage student records and class assignments</p>
                </div>

                <!-- Add Student Form -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Add New Student" data-sw="Ongeza Mwanafunzi Mpya">Add New Student</h3>
                    <form onsubmit="addStudent(event)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Student Name" data-sw="Jina la Mwanafunzi">Student Name</label>
                            <input type="text" id="studentName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Class" data-sw="Darasa">Class</label>
                            <select id="studentClass" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                                <option value="">Select Class</option>
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Parent Name" data-sw="Jina la Mzazi">Parent Name</label>
                            <input type="text" id="parentName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Parent Phone" data-sw="Simu ya Mzazi">Parent Phone</label>
                            <input type="tel" id="parentPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" placeholder="+254..." required>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                <span data-en="Add Student" data-sw="Ongeza Mwanafunzi">Add Student</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Students List -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Students List" data-sw="Orodha ya Wanafunzi">Students List</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-en="Student" data-sw="Mwanafunzi">Student</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-en="Class" data-sw="Darasa">Class</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-en="Parent" data-sw="Mzazi">Parent</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-en="Phone" data-sw="Simu">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-en="Actions" data-sw="Vitendo">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Students will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Messaging Section -->
            <div id="messaging" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Messaging" data-sw="Ujumbe">Messaging</h2>
                    <p class="text-gray-600" data-en="Send messages to parents and students" data-sw="Tuma ujumbe kwa wazazi na wanafunzi">Send messages to parents and students</p>
                </div>

                <!-- Message content will be populated based on user role -->
                <div id="messagingContent">
                    <!-- Content will be populated based on user role -->
                </div>
            </div>

            <!-- Homework Section (Admin/Teacher) -->
            <div id="homework" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Homework Management" data-sw="Usimamizi wa Kazi ya Nyumbani">Homework Management</h2>
                    <p class="text-gray-600" data-en="Create and manage homework assignments" data-sw="Tengeneza na simamia kazi za nyumbani">Create and manage homework assignments</p>
                </div>

                <!-- Add Homework Form -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Create New Assignment" data-sw="Tengeneza Kazi Mpya">Create New Assignment</h3>
                    <form onsubmit="addHomework(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Subject" data-sw="Somo">Subject</label>
                                <select id="homeworkSubject" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                                    <option value="">Select Subject</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="English">English</option>
                                    <option value="Science">Science</option>
                                    <option value="Social Studies">Social Studies</option>
                                    <option value="Kiswahili">Kiswahili</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Class" data-sw="Darasa">Class</label>
                                <select id="homeworkClass" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                                    <option value="">Select Class</option>
                                    <option value="Grade 1">Grade 1</option>
                                    <option value="Grade 2">Grade 2</option>
                                    <option value="Grade 3">Grade 3</option>
                                    <option value="Grade 4">Grade 4</option>
                                    <option value="Grade 5">Grade 5</option>
                                    <option value="Grade 6">Grade 6</option>
                                    <option value="Grade 7">Grade 7</option>
                                    <option value="Grade 8">Grade 8</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Assignment Title" data-sw="Kichwa cha Kazi">Assignment Title</label>
                            <input type="text" id="homeworkTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Description" data-sw="Maelezo">Description</label>
                            <textarea id="homeworkDescription" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Due Date" data-sw="Tarehe ya Mwisho">Due Date</label>
                                <input type="date" id="homeworkDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Attachment (Optional)" data-sw="Kiambatisho (Si Lazima)">Attachment (Optional)</label>
                                <input type="file" id="homeworkFile" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" accept=".pdf,.doc,.docx,.jpg,.png">
                            </div>
                        </div>
                        <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                            <span data-en="Create Assignment" data-sw="Tengeneza Kazi">Create Assignment</span>
                        </button>
                    </form>
                </div>

                <!-- Homework List -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Active Assignments" data-sw="Kazi Zinazoendelea">Active Assignments</h3>
                    <div id="homeworkList" class="space-y-4">
                        <!-- Homework items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Fees Section (Admin only) -->
            <div id="fees" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Fee Management" data-sw="Usimamizi wa Ada">Fee Management</h2>
                    <p class="text-gray-600" data-en="Manage student fees and payments" data-sw="Simamia ada za wanafunzi na malipo">Manage student fees and payments</p>
                </div>

                <!-- Fee Structure Setup -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Set Fee Structure" data-sw="Weka Muundo wa Ada">Set Fee Structure</h3>
                    <form onsubmit="addFeeStructure(event)" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Fee Type" data-sw="Aina ya Ada">Fee Type</label>
                            <input type="text" id="feeType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" placeholder="e.g., Tuition, Transport" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Amount (Ksh)" data-sw="Kiasi (Ksh)">Amount (Ksh)</label>
                            <input type="number" id="feeAmount" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>
                        <div class="flex items-end">
                            <button type="submit" class="w-full bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                <span data-en="Add Fee Type" data-sw="Ongeza Aina ya Ada">Add Fee Type</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Fee Structure Display -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Current Fee Structure" data-sw="Muundo wa Ada wa Sasa">Current Fee Structure</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fee Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount (Ksh)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="feeStructureTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Fee structure will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Student Fee Records -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Student Fee Records" data-sw="Rekodi za Ada za Wanafunzi">Student Fee Records</h3>
                    <div class="mb-4">
                        <input type="text" id="feeSearchStudent" onkeyup="searchStudentFees()" placeholder="Search student..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Class</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Fees</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paid</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Balance</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentFeesTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Student fee records will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Attendance Section (Admin/Teacher) -->
            <div id="attendance" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Attendance Management" data-sw="Usimamizi wa Mahudhurio">Attendance Management</h2>
                    <p class="text-gray-600" data-en="Mark and track student attendance" data-sw="Weka na fuatilia mahudhurio ya wanafunzi">Mark and track student attendance</p>
                </div>

                <!-- Attendance Marking -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Mark Attendance" data-sw="Weka Mahudhurio">Mark Attendance</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Date" data-sw="Tarehe">Date</label>
                            <input type="date" id="attendanceDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Class" data-sw="Darasa">Class</label>
                            <select id="attendanceClass" onchange="loadStudentsForAttendance()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                                <option value="">Select Class</option>
                                <option value="Grade 1">Grade 1</option>
                                <option value="Grade 2">Grade 2</option>
                                <option value="Grade 3">Grade 3</option>
                                <option value="Grade 4">Grade 4</option>
                                <option value="Grade 5">Grade 5</option>
                                <option value="Grade 6">Grade 6</option>
                                <option value="Grade 7">Grade 7</option>
                                <option value="Grade 8">Grade 8</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button onclick="markAllPresent()" class="w-full bg-success text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                                <span data-en="Mark All Present" data-sw="Weka Wote Wapo">Mark All Present</span>
                            </button>
                        </div>
                    </div>

                    <!-- Student Attendance List -->
                    <div id="attendanceStudentsList" class="space-y-2">
                        <!-- Students for attendance will be populated here -->
                    </div>

                    <div class="mt-6">
                        <button onclick="saveAttendance()" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                            <span data-en="Save Attendance" data-sw="Hifadhi Mahudhurio">Save Attendance</span>
                        </button>
                    </div>
                </div>

                <!-- Attendance Reports -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Attendance Reports" data-sw="Ripoti za Mahudhurio">Attendance Reports</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <p class="text-2xl font-bold text-blue-600" id="totalStudentsCount">0</p>
                            <p class="text-sm text-blue-800" data-en="Total Students" data-sw="Wanafunzi Wote">Total Students</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <p class="text-2xl font-bold text-green-600" id="presentTodayCount">0</p>
                            <p class="text-sm text-green-800" data-en="Present Today" data-sw="Wapo Leo">Present Today</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg text-center">
                            <p class="text-2xl font-bold text-red-600" id="absentTodayCount">0</p>
                            <p class="text-sm text-red-800" data-en="Absent Today" data-sw="Hawako Leo">Absent Today</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg text-center">
                            <p class="text-2xl font-bold text-yellow-600" id="attendancePercentage">0%</p>
                            <p class="text-sm text-yellow-800" data-en="Attendance Rate" data-sw="Kiwango cha Mahudhurio">Attendance Rate</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Parent-specific sections -->
            <div id="child-info" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Child Information" data-sw="Taarifa za Mtoto">Child Information</h2>
                    <p class="text-gray-600" data-en="View your child's school information" data-sw="Ona taarifa za shule za mtoto wako">View your child's school information</p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Student Details</h3>
                            <div class="space-y-3" id="childDetails">
                                <!-- Child details will be populated dynamically -->
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>
                            <div class="space-y-2">
                                <div class="p-3 bg-green-50 rounded-lg">
                                    <p class="text-sm text-green-800">Present today</p>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-lg">
                                    <p class="text-sm text-blue-800">Math homework due tomorrow</p>
                                </div>
                                <div class="p-3 bg-yellow-50 rounded-lg">
                                    <p class="text-sm text-yellow-800">Fee payment due Friday</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Parent Homework View (Read-only) -->
            <div id="parent-homework" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Homework Assignments" data-sw="Kazi za Nyumbani">Homework Assignments</h2>
                    <p class="text-gray-600" data-en="Download and view your child's homework" data-sw="Pakua na ona kazi za nyumbani za mtoto wako">Download and view your child's homework</p>
                </div>

                <div class="space-y-4">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Mathematics - Grade 5</h3>
                                <p class="text-gray-600">Complete exercises 1-10 on page 45</p>
                                <p class="text-sm text-gray-500 mt-2">Assigned by: Mrs. Johnson</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">Due: Tomorrow</p>
                                <button onclick="downloadHomework('math-grade5')" class="mt-2 bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    ðŸ“¥ Download
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">English - Grade 5</h3>
                                <p class="text-gray-600">Read chapter 5 and answer comprehension questions</p>
                                <p class="text-sm text-gray-500 mt-2">Assigned by: Mr. Smith</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">Due: Friday</p>
                                <button onclick="downloadHomework('english-grade5')" class="mt-2 bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                    ðŸ“¥ Download
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Parent Fees View -->
            <div id="parent-fees" class="section hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900 mb-2" data-en="Fee Information" data-sw="Taarifa za Ada">Fee Information</h2>
                    <p class="text-gray-600" data-en="View fee balances and payment history" data-sw="Ona mizani ya ada na historia ya malipo">View fee balances and payment history</p>
                </div>

                <!-- Fee Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-primary">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-en="Total Fees" data-sw="Ada Jumla">Total Fees</h3>
                        <p class="text-3xl font-bold text-primary">Ksh 15,000</p>
                        <p class="text-sm text-gray-600">This term</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-success">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-en="Paid" data-sw="Imelipwa">Paid</h3>
                        <p class="text-3xl font-bold text-success">Ksh 10,000</p>
                        <p class="text-sm text-gray-600">Amount paid</p>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-danger">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-en="Balance" data-sw="Salio">Balance</h3>
                        <p class="text-3xl font-bold text-danger">Ksh 5,000</p>
                        <p class="text-sm text-gray-600">Outstanding</p>
                    </div>
                </div>

                <!-- Fee Breakdown -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Fee Breakdown" data-sw="Mgawanyo wa Ada">Fee Breakdown</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fee Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paid</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Balance</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Tuition</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ksh 12,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">Ksh 8,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-danger">Ksh 4,000</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Transport</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ksh 2,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">Ksh 2,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">Ksh 0</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Lunch</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ksh 1,000</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ksh 0</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-danger">Ksh 1,000</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Payment History -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Payment History" data-sw="Historia ya Malipo">Payment History</h3>
                    <div class="space-y-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-medium text-gray-900">Payment - Ksh 5,000</p>
                                    <p class="text-sm text-gray-600">Tuition fee payment</p>
                                    <p class="text-xs text-gray-500">January 15, 2024</p>
                                </div>
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Confirmed</span>
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-medium text-gray-900">Payment - Ksh 3,000</p>
                                    <p class="text-sm text-gray-600">Tuition + Transport</p>
                                    <p class="text-xs text-gray-500">January 5, 2024</p>
                                </div>
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Confirmed</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed top-4 right-4 bg-success text-white px-6 py-3 rounded-lg shadow-lg hidden notification">
        <p id="notificationText">Action completed successfully!</p>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentLanguage = 'en';
        let schools = [
            { 
                id: 1, 
                name: 'Demo School', 
                email: 'admin@demoschool.com', 
                postalAddress: 'P.O. Box 123, Nairobi', 
                county: 'Nairobi', 
                subcounty: 'Westlands', 
                code: 'SCH001',
                adminId: 1
            }
        ];
        
        let users = [
            // Demo users
            { id: 1, email: 'admin@school.com', password: 'admin123', role: 'admin', firstName: 'John', lastName: 'Admin', schoolId: 1, phone: '+254700000001' },
            { id: 2, email: 'teacher@school.com', password: 'teacher123', role: 'teacher', firstName: 'Jane', lastName: 'Teacher', schoolId: 1, phone: '+254700000002' },
            { id: 3, email: 'parent@school.com', password: 'parent123', role: 'parent', firstName: 'Mary', lastName: 'Parent', schoolId: 1, studentName: 'Alice Wanjiku', registrationNumber: 'STD001', studentClass: 'Grade 5', phone: '+254700000003' }
        ];
        let students = [
            { id: 1, name: 'Alice Wanjiku', class: 'Grade 5', parent: 'Mary Parent', phone: '+254700000003', parentId: 3 },
            { id: 2, name: 'James Kiprotich', class: 'Grade 3', parent: 'Peter Kiprotich', phone: '+254723456789', parentId: null }
        ];
        
        // Additional data structures for full functionality
        let messages = [
            { id: 1, from: 'Jane Teacher', to: 'All Parents - Grade 5', subject: 'Parent Meeting', content: 'Dear parents, we will have a meeting on Friday at 2 PM to discuss the upcoming exams.', date: new Date('2024-01-15'), read: false, fromUserId: 2, toClass: 'Grade 5' },
            { id: 2, from: 'John Admin', to: 'All Parents', subject: 'School Fees Reminder', content: 'This is a reminder that school fees for this term are due by the end of this week.', date: new Date('2024-01-14'), read: true, fromUserId: 1, toClass: 'All' }
        ];
        
        let homework = [
            { id: 1, subject: 'Mathematics', class: 'Grade 5', title: 'Fractions Exercise', description: 'Complete exercises 1-10 on page 45. Show all working.', dueDate: '2024-01-20', createdBy: 'Jane Teacher', createdById: 2, attachment: null },
            { id: 2, subject: 'English', class: 'Grade 5', title: 'Reading Comprehension', description: 'Read chapter 5 and answer the comprehension questions at the end.', dueDate: '2024-01-22', createdBy: 'Jane Teacher', createdById: 2, attachment: null }
        ];
        
        let feeStructure = [
            { id: 1, type: 'Tuition', amount: 12000 },
            { id: 2, type: 'Transport', amount: 2000 },
            { id: 3, type: 'Lunch', amount: 1000 }
        ];
        
        let studentFees = [
            { studentId: 1, totalFees: 15000, paidAmount: 10000, balance: 5000, payments: [
                { amount: 5000, date: '2024-01-15', type: 'Tuition' },
                { amount: 3000, date: '2024-01-05', type: 'Tuition + Transport' },
                { amount: 2000, date: '2024-01-01', type: 'Transport' }
            ]},
            { studentId: 2, totalFees: 15000, paidAmount: 8000, balance: 7000, payments: [
                { amount: 8000, date: '2024-01-10', type: 'Partial Payment' }
            ]}
        ];
        
        let attendance = [
            { studentId: 1, date: '2024-01-15', status: 'present' },
            { studentId: 2, date: '2024-01-15', status: 'present' },
            { studentId: 1, date: '2024-01-14', status: 'present' },
            { studentId: 2, date: '2024-01-14', status: 'absent' }
        ];

        // Authentication functions
        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            
            // Find user
            const user = users.find(u => u.email === email && u.password === password && u.role === role);
            
            if (user) {
                currentUser = user;
                showMainApp();
                showNotification(`Welcome back, ${user.firstName}!`);
            } else {
                showNotification('Invalid credentials. Please check your email, password, and role.', 'error');
            }
        }

        function handleSignup(event) {
            event.preventDefault();
            
            const role = document.getElementById('signupRole').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // Validation
            if (password !== confirmPassword) {
                showNotification('Passwords do not match!', 'error');
                return;
            }
            
            let newUser = {};
            let newSchool = null;
            
            if (role === 'admin') {
                const firstName = document.getElementById('adminFirstName').value;
                const lastName = document.getElementById('adminLastName').value;
                const email = document.getElementById('adminEmail').value;
                const phone = document.getElementById('adminPhone').value;
                const schoolName = document.getElementById('schoolName').value;
                const schoolEmail = document.getElementById('schoolEmail').value;
                const postalAddress = document.getElementById('schoolPostalAddress').value;
                const county = document.getElementById('schoolCounty').value;
                const subcounty = document.getElementById('schoolSubcounty').value;
                
                if (users.find(u => u.email === email)) {
                    showNotification('Email already exists!', 'error');
                    return;
                }
                
                // Generate unique school code
                const schoolCode = generateSchoolCode();
                
                // Create school
                newSchool = {
                    id: schools.length + 1,
                    name: schoolName,
                    email: schoolEmail,
                    postalAddress: postalAddress,
                    county: county,
                    subcounty: subcounty,
                    code: schoolCode,
                    adminId: users.length + 1
                };
                
                // Create admin user
                newUser = {
                    id: users.length + 1,
                    email: email,
                    password: password,
                    role: role,
                    firstName: firstName,
                    lastName: lastName,
                    phone: phone,
                    schoolId: newSchool.id
                };
                
                schools.push(newSchool);
                users.push(newUser);
                
                showNotification(`School registered successfully! Your school code is: ${schoolCode}. Please save this code and share it with teachers and parents.`);
                
            } else if (role === 'teacher') {
                const fullName = document.getElementById('teacherFullName').value;
                const email = document.getElementById('teacherEmail').value;
                const phone = document.getElementById('teacherPhone').value;
                const schoolName = document.getElementById('teacherSchoolName').value;
                const schoolCode = document.getElementById('teacherSchoolCode').value;
                
                if (users.find(u => u.email === email)) {
                    showNotification('Email already exists!', 'error');
                    return;
                }
                
                // Verify school code
                const school = schools.find(s => s.code === schoolCode && s.name === schoolName);
                if (!school) {
                    showNotification('Invalid school name or code!', 'error');
                    return;
                }
                
                const nameParts = fullName.split(' ');
                newUser = {
                    id: users.length + 1,
                    email: email,
                    password: password,
                    role: role,
                    firstName: nameParts[0],
                    lastName: nameParts.slice(1).join(' '),
                    phone: phone,
                    schoolId: school.id
                };
                
                users.push(newUser);
                showNotification('Teacher account created successfully! Please login.');
                
            } else if (role === 'parent') {
                const fullName = document.getElementById('parentFullName').value;
                const phone = document.getElementById('parentPhone').value;
                const schoolName = document.getElementById('parentSchoolName').value;
                const schoolCode = document.getElementById('parentSchoolCode').value;
                const studentName = document.getElementById('parentStudentName').value;
                const registrationNumber = document.getElementById('parentRegistrationNumber').value;
                const studentClass = document.getElementById('parentStudentClass').value;
                
                // Generate email from phone number for parents
                const email = `parent${phone.replace(/\D/g, '')}@eduloop.com`;
                
                if (users.find(u => u.email === email)) {
                    showNotification('Phone number already registered!', 'error');
                    return;
                }
                
                // Verify school code
                const school = schools.find(s => s.code === schoolCode && s.name === schoolName);
                if (!school) {
                    showNotification('Invalid school name or code!', 'error');
                    return;
                }
                
                const nameParts = fullName.split(' ');
                newUser = {
                    id: users.length + 1,
                    email: email,
                    password: password,
                    role: role,
                    firstName: nameParts[0],
                    lastName: nameParts.slice(1).join(' '),
                    phone: phone,
                    schoolId: school.id,
                    studentName: studentName,
                    registrationNumber: registrationNumber,
                    studentClass: studentClass
                };
                
                users.push(newUser);
                showNotification(`Parent account created successfully! Your login email is: ${email}. Please login.`);
            }
            
            showLoginForm();
        }

        function showSignupForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function toggleRoleFields() {
            const role = document.getElementById('signupRole').value;
            const adminFields = document.getElementById('adminFields');
            const teacherFields = document.getElementById('teacherFields');
            const parentFields = document.getElementById('parentFields');
            
            // Hide all fields first
            adminFields.classList.add('hidden');
            teacherFields.classList.add('hidden');
            parentFields.classList.add('hidden');
            
            // Show relevant fields
            if (role === 'admin') {
                adminFields.classList.remove('hidden');
                setFieldsRequired('admin', true);
                setFieldsRequired('teacher', false);
                setFieldsRequired('parent', false);
            } else if (role === 'teacher') {
                teacherFields.classList.remove('hidden');
                setFieldsRequired('admin', false);
                setFieldsRequired('teacher', true);
                setFieldsRequired('parent', false);
            } else if (role === 'parent') {
                parentFields.classList.remove('hidden');
                setFieldsRequired('admin', false);
                setFieldsRequired('teacher', false);
                setFieldsRequired('parent', true);
            }
        }
        
        function setFieldsRequired(role, required) {
            const fields = {
                admin: ['adminFirstName', 'adminLastName', 'adminEmail', 'adminPhone', 'schoolName', 'schoolEmail', 'schoolPostalAddress', 'schoolCounty', 'schoolSubcounty'],
                teacher: ['teacherFullName', 'teacherEmail', 'teacherPhone', 'teacherSchoolName', 'teacherSchoolCode'],
                parent: ['parentFullName', 'parentPhone', 'parentSchoolName', 'parentSchoolCode', 'parentStudentName', 'parentRegistrationNumber', 'parentStudentClass']
            };
            
            if (fields[role]) {
                fields[role].forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.required = required;
                    }
                });
            }
        }
        
        function generateSchoolCode() {
            const prefix = 'SCH';
            const number = String(schools.length + 1).padStart(3, '0');
            return prefix + number;
        }
        
        function loadSubcounties() {
            const county = document.getElementById('schoolCounty').value;
            const subcountySelect = document.getElementById('schoolSubcounty');
            
            const subcounties = {
                'Nairobi': ['Westlands', 'Starehe', 'Langata', 'Dagoretti', 'Embakasi'],
                'Mombasa': ['Mvita', 'Changamwe', 'Jomba', 'Kisauni', 'Nyali'],
                'Kiambu': ['Thika', 'Ruiru', 'Juja', 'Lari', 'Limuru'],
                'Nakuru': ['Nakuru East', 'Nakuru West', 'Gilgil', 'Naivasha', 'Molo'],
                'Kisumu': ['Kisumu East', 'Kisumu West', 'Kisumu Central', 'Nyando', 'Muhoroni']
            };
            
            subcountySelect.innerHTML = '<option value="">Select Subcounty</option>';
            
            if (subcounties[county]) {
                subcounties[county].forEach(subcounty => {
                    const option = document.createElement('option');
                    option.value = subcounty;
                    option.textContent = subcounty;
                    subcountySelect.appendChild(option);
                });
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authScreen').classList.remove('hidden');
            showNotification('Logged out successfully!');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Setup user interface based on role
            setupUserInterface();
            loadDashboardContent();
        }

        function setupUserInterface() {
            if (!currentUser) return;
            
            // Update user info
            document.getElementById('userInfo').textContent = `${currentUser.firstName} ${currentUser.lastName} (${currentUser.role})`;
            document.getElementById('userAvatar').textContent = currentUser.firstName.charAt(0).toUpperCase();
            
            // Setup navigation based on role
            const navMenu = document.getElementById('navMenu');
            const mobileNavMenu = document.getElementById('mobileNavMenu');
            
            let navItems = [];
            
            if (currentUser.role === 'admin') {
                navItems = [
                    { id: 'dashboard', label: 'Dashboard', labelSw: 'Dashibodi' },
                    { id: 'students', label: 'Students', labelSw: 'Wanafunzi' },
                    { id: 'messaging', label: 'Messaging', labelSw: 'Ujumbe' },
                    { id: 'homework', label: 'Homework', labelSw: 'Kazi ya Nyumbani' },
                    { id: 'fees', label: 'Fees', labelSw: 'Ada' },
                    { id: 'attendance', label: 'Attendance', labelSw: 'Mahudhurio' }
                ];
            } else if (currentUser.role === 'teacher') {
                navItems = [
                    { id: 'dashboard', label: 'Dashboard', labelSw: 'Dashibodi' },
                    { id: 'students', label: 'Students', labelSw: 'Wanafunzi' },
                    { id: 'messaging', label: 'Messaging', labelSw: 'Ujumbe' },
                    { id: 'homework', label: 'Homework', labelSw: 'Kazi ya Nyumbani' },
                    { id: 'attendance', label: 'Attendance', labelSw: 'Mahudhurio' }
                ];
            } else if (currentUser.role === 'parent') {
                navItems = [
                    { id: 'dashboard', label: 'Dashboard', labelSw: 'Dashibodi' },
                    { id: 'child-info', label: 'Child Info', labelSw: 'Taarifa za Mtoto' },
                    { id: 'messaging', label: 'Messages', labelSw: 'Ujumbe' },
                    { id: 'homework', label: 'Homework', labelSw: 'Kazi ya Nyumbani' },
                    { id: 'fees', label: 'Fees', labelSw: 'Ada' }
                ];
            }
            
            // Create navigation items
            navMenu.innerHTML = '';
            mobileNavMenu.innerHTML = '';
            
            navItems.forEach(item => {
                // Desktop nav
                const navBtn = document.createElement('button');
                navBtn.onclick = () => showSection(item.id);
                navBtn.className = 'nav-btn text-gray-700 hover:bg-primary hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors';
                navBtn.setAttribute('data-en', item.label);
                navBtn.setAttribute('data-sw', item.labelSw);
                navBtn.textContent = item.label;
                navMenu.appendChild(navBtn);
                
                // Mobile nav
                const mobileNavBtn = document.createElement('button');
                mobileNavBtn.onclick = () => showSection(item.id);
                mobileNavBtn.className = 'nav-btn-mobile block text-gray-700 hover:bg-primary hover:text-white px-3 py-2 rounded-md text-base font-medium w-full text-left transition-colors';
                mobileNavBtn.setAttribute('data-en', item.label);
                mobileNavBtn.setAttribute('data-sw', item.labelSw);
                mobileNavBtn.textContent = item.label;
                mobileNavMenu.appendChild(mobileNavBtn);
            });
            
            // Load messaging content based on role
            loadMessagingContent();
            
            // Initialize all data displays
            setTimeout(() => {
                updateStudentsTable();
                loadFeeStructure();
                loadStudentFees();
                updateAttendanceStats();
                loadMessages();
            }, 100);
        }
        
        function loadMessagingContent() {
            const messagingContent = document.getElementById('messagingContent');
            
            if (currentUser.role === 'admin' || currentUser.role === 'teacher') {
                // Admin and Teacher can send messages
                messagingContent.innerHTML = `
                    <!-- Send Message Form -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Send New Message" data-sw="Tuma Ujumbe Mpya">Send New Message</h3>
                        <form onsubmit="sendMessage(event)" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Recipients" data-sw="Wapokeaji">Recipients</label>
                                    <select id="messageRecipients" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                                        <option value="">Select Recipients</option>
                                        <option value="All">All Parents</option>
                                        <option value="Grade 1">Grade 1 Parents</option>
                                        <option value="Grade 2">Grade 2 Parents</option>
                                        <option value="Grade 3">Grade 3 Parents</option>
                                        <option value="Grade 4">Grade 4 Parents</option>
                                        <option value="Grade 5">Grade 5 Parents</option>
                                        <option value="Grade 6">Grade 6 Parents</option>
                                        <option value="Grade 7">Grade 7 Parents</option>
                                        <option value="Grade 8">Grade 8 Parents</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Priority" data-sw="Kipaumbele">Priority</label>
                                    <select id="messagePriority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                                        <option value="normal">Normal</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Subject" data-sw="Mada">Subject</label>
                                <input type="text" id="messageSubject" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-en="Message" data-sw="Ujumbe">Message</label>
                                <textarea id="messageContent" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" required></textarea>
                            </div>
                            <button type="submit" class="bg-primary text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                                <span data-en="Send Message" data-sw="Tuma Ujumbe">Send Message</span>
                            </button>
                        </form>
                    </div>

                    <!-- Sent Messages -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Sent Messages" data-sw="Ujumbe Uliotumwa">Sent Messages</h3>
                        <div id="sentMessagesList" class="space-y-4">
                            <!-- Sent messages will be populated here -->
                        </div>
                    </div>
                `;
            } else if (currentUser.role === 'parent') {
                // Parents can only view messages
                messagingContent.innerHTML = `
                    <!-- Received Messages -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Messages" data-sw="Ujumbe">Messages</h3>
                        <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-800" data-en="You can view messages from teachers and school administration. You cannot reply to messages through this system." data-sw="Unaweza kuona ujumbe kutoka kwa walimu na utawala wa shule. Huwezi kujibu ujumbe kupitia mfumo huu.">
                                You can view messages from teachers and school administration. You cannot reply to messages through this system.
                            </p>
                        </div>
                        <div id="receivedMessagesList" class="space-y-4">
                            <!-- Received messages will be populated here -->
                        </div>
                    </div>
                `;
            }
            
            // Load messages
            loadMessages();
        }

        function loadDashboardContent() {
            const dashboardContent = document.getElementById('dashboardContent');
            
            if (currentUser.role === 'admin') {
                dashboardContent.innerHTML = `
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-primary">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">ðŸ‘¥</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600" data-en="Total Students" data-sw="Wanafunzi Wote">Total Students</p>
                                    <p class="text-2xl font-bold text-gray-900">247</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-success">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-success rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">âœ…</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600" data-en="Present Today" data-sw="Waliopo Leo">Present Today</p>
                                    <p class="text-2xl font-bold text-gray-900">231</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-secondary">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-secondary rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">ðŸ’°</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600" data-en="Pending Fees" data-sw="Ada Zinazongoja">Pending Fees</p>
                                    <p class="text-2xl font-bold text-gray-900">Ksh 45K</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-danger">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-danger rounded-full flex items-center justify-center">
                                        <span class="text-white text-sm">ðŸ“±</span>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600" data-en="Messages Sent" data-sw="Ujumbe Uliotumwa">Messages Sent</p>
                                    <p class="text-2xl font-bold text-gray-900">1,234</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Quick Actions" data-sw="Vitendo vya Haraka">Quick Actions</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="showSection('messaging')" class="flex flex-col items-center p-4 bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <span class="text-2xl mb-2">ðŸ“±</span>
                                <span class="text-sm font-medium" data-en="Send Message" data-sw="Tuma Ujumbe">Send Message</span>
                            </button>
                            <button onclick="showSection('students')" class="flex flex-col items-center p-4 bg-success text-white rounded-lg hover:bg-green-700 transition-colors">
                                <span class="text-2xl mb-2">âž•</span>
                                <span class="text-sm font-medium" data-en="Add Student" data-sw="Ongeza Mwanafunzi">Add Student</span>
                            </button>
                            <button onclick="showSection('homework')" class="flex flex-col items-center p-4 bg-secondary text-white rounded-lg hover:bg-yellow-600 transition-colors">
                                <span class="text-2xl mb-2">ðŸ“š</span>
                                <span class="text-sm font-medium" data-en="Upload Homework" data-sw="Pakia Kazi ya Nyumbani">Upload Homework</span>
                            </button>
                            <button onclick="showSection('attendance')" class="flex flex-col items-center p-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                <span class="text-2xl mb-2">âœ…</span>
                                <span class="text-sm font-medium" data-en="Mark Attendance" data-sw="Weka Mahudhurio">Mark Attendance</span>
                            </button>
                        </div>
                    </div>
                `;
            } else if (currentUser.role === 'teacher') {
                dashboardContent.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-primary">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">My Classes</h3>
                            <p class="text-3xl font-bold text-primary">5</p>
                            <p class="text-sm text-gray-600">Active classes</p>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-success">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Students</h3>
                            <p class="text-3xl font-bold text-success">125</p>
                            <p class="text-sm text-gray-600">Total students</p>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-secondary">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Homework</h3>
                            <p class="text-3xl font-bold text-secondary">8</p>
                            <p class="text-sm text-gray-600">Pending assignments</p>
                        </div>
                    </div>
                `;
            } else if (currentUser.role === 'parent') {
                const school = schools.find(s => s.id === currentUser.schoolId);
                dashboardContent.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Child Overview</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Name:</span>
                                    <span class="font-medium">${currentUser.studentName || 'Not specified'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Class:</span>
                                    <span class="font-medium">${currentUser.studentClass || 'Not specified'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Registration No:</span>
                                    <span class="font-medium">${currentUser.registrationNumber || 'Not specified'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">School:</span>
                                    <span class="font-medium">${school ? school.name : 'Unknown'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Attendance:</span>
                                    <span class="font-medium text-success">95%</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Updates</h3>
                            <div class="space-y-3">
                                <div class="p-3 bg-blue-50 rounded-lg">
                                    <p class="text-sm text-blue-800">Math homework assigned</p>
                                    <p class="text-xs text-blue-600">2 hours ago</p>
                                </div>
                                <div class="p-3 bg-green-50 rounded-lg">
                                    <p class="text-sm text-green-800">Present in school today</p>
                                    <p class="text-xs text-green-600">Today</p>
                                </div>
                                <div class="p-3 bg-yellow-50 rounded-lg">
                                    <p class="text-sm text-yellow-800">Fee balance: Ksh 5,000</p>
                                    <p class="text-xs text-yellow-600">Due Friday</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions for Parents -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-en="Quick Actions" data-sw="Vitendo vya Haraka">Quick Actions</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="showSection('child-info')" class="flex flex-col items-center p-4 bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors">
                                <span class="text-2xl mb-2">ðŸ‘¶</span>
                                <span class="text-sm font-medium" data-en="Child Info" data-sw="Taarifa za Mtoto">Child Info</span>
                            </button>
                            <button onclick="showSection('homework')" class="flex flex-col items-center p-4 bg-success text-white rounded-lg hover:bg-green-700 transition-colors">
                                <span class="text-2xl mb-2">ðŸ“š</span>
                                <span class="text-sm font-medium" data-en="Homework" data-sw="Kazi ya Nyumbani">Homework</span>
                            </button>
                            <button onclick="showSection('fees')" class="flex flex-col items-center p-4 bg-secondary text-white rounded-lg hover:bg-yellow-600 transition-colors">
                                <span class="text-2xl mb-2">ðŸ’°</span>
                                <span class="text-sm font-medium" data-en="Fees" data-sw="Ada">Fees</span>
                            </button>
                            <button onclick="showSection('messaging')" class="flex flex-col items-center p-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                <span class="text-2xl mb-2">ðŸ“±</span>
                                <span class="text-sm font-medium" data-en="Messages" data-sw="Ujumbe">Messages</span>
                            </button>
                        </div>
                    </div>
                `;
                
                // Populate child details
                const childDetails = document.getElementById('childDetails');
                if (childDetails) {
                    childDetails.innerHTML = `
                        <div>
                            <label class="text-sm font-medium text-gray-600">Name:</label>
                            <p class="text-gray-900">${currentUser.studentName || 'Not specified'}</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600">Class:</label>
                            <p class="text-gray-900">${currentUser.studentClass || 'Not specified'}</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600">Registration Number:</label>
                            <p class="text-gray-900">${currentUser.registrationNumber || 'Not specified'}</p>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-600">School:</label>
                            <p class="text-gray-900">${school ? school.name : 'Unknown'}</p>
                        </div>
                    `;
                }
            }
        }



        // Language toggle function
        function toggleLanguage() {
            const select = document.getElementById('languageSelect');
            currentLanguage = select.value;
            
            const elements = document.querySelectorAll('[data-en][data-sw]');
            elements.forEach(element => {
                if (currentLanguage === 'sw') {
                    element.textContent = element.getAttribute('data-sw');
                } else {
                    element.textContent = element.getAttribute('data-en');
                }
            });
        }

        // Student management functions
        function addStudent(event) {
            event.preventDefault();
            
            const name = document.getElementById('studentName').value;
            const studentClass = document.getElementById('studentClass').value;
            const parentName = document.getElementById('parentName').value;
            const parentPhone = document.getElementById('parentPhone').value;
            
            const newStudent = {
                id: students.length + 1,
                name: name,
                class: studentClass,
                parent: parentName,
                phone: parentPhone
            };
            
            students.push(newStudent);
            updateStudentsTable();
            showNotification('Student added successfully!');
            
            // Reset form
            event.target.reset();
        }

        function updateStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.class}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.parent}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="text-primary hover:text-blue-700 mr-3">Edit</button>
                        <button class="text-danger hover:text-red-700" onclick="deleteStudent(${student.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function deleteStudent(id) {
            students = students.filter(student => student.id !== id);
            updateStudentsTable();
            showNotification('Student deleted successfully!');
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            
            // Set color based on type
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg notification ${
                type === 'error' ? 'bg-danger' : 'bg-success'
            } text-white`;
            
            notification.classList.remove('hidden');
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        // Parent-specific functions
        function downloadHomework(homeworkId) {
            // Create a sample homework file (base64 encoded PDF placeholder)
            const samplePDF = 'data:application/pdf;base64,JVBERi0xLjQKMSAwIG9iago8PAovVHlwZSAvQ2F0YWxvZwovUGFnZXMgMiAwIFIKPj4KZW5kb2JqCjIgMCBvYmoKPDwKL1R5cGUgL1BhZ2VzCi9LaWRzIFszIDAgUl0KL0NvdW50IDEKPD4KZW5kb2JqCjMgMCBvYmoKPDwKL1R5cGUgL1BhZ2UKL1BhcmVudCAyIDAgUgovTWVkaWFCb3ggWzAgMCA2MTIgNzkyXQovUmVzb3VyY2VzIDw8Ci9Gb250IDw8Ci9GMSA0IDAgUgo+Pgo+PgovQ29udGVudHMgNSAwIFIKPj4KZW5kb2JqCjQgMCBvYmoKPDwKL1R5cGUgL0ZvbnQKL1N1YnR5cGUgL1R5cGUxCi9CYXNlRm9udCAvSGVsdmV0aWNhCj4+CmVuZG9iago1IDAgb2JqCjw8Ci9MZW5ndGggNDQKPj4Kc3RyZWFtCkJUCi9GMSAxMiBUZgoxMDAgNzAwIFRkCihIb21ld29yayBBc3NpZ25tZW50KSBUagpFVApzdHJlYW0KZW5kb2JqCnhyZWYKMCA2CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDAwOSAwMDAwMCBuIAowMDAwMDAwMDU4IDAwMDAwIG4gCjAwMDAwMDAxMTUgMDAwMDAgbiAKMDAwMDAwMDI0NSAwMDAwMCBuIAowMDAwMDAwMzIyIDAwMDAwIG4gCnRyYWlsZXIKPDwKL1NpemUgNgovUm9vdCAxIDAgUgo+PgpzdGFydHhyZWYKNDE0CiUlRU9G';
            
            // Create download link
            const link = document.createElement('a');
            link.href = samplePDF;
            link.download = `homework-${homeworkId}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Homework downloaded successfully!');
        }

        // Messaging functions
        function sendMessage(event) {
            event.preventDefault();
            
            const recipients = document.getElementById('messageRecipients').value;
            const priority = document.getElementById('messagePriority').value;
            const subject = document.getElementById('messageSubject').value;
            const content = document.getElementById('messageContent').value;
            
            const newMessage = {
                id: messages.length + 1,
                from: `${currentUser.firstName} ${currentUser.lastName}`,
                to: recipients === 'All' ? 'All Parents' : `${recipients} Parents`,
                subject: subject,
                content: content,
                date: new Date(),
                read: false,
                fromUserId: currentUser.id,
                toClass: recipients,
                priority: priority
            };
            
            messages.push(newMessage);
            showNotification('Message sent successfully!');
            
            // Reset form
            event.target.reset();
            
            // Reload messages
            loadMessages();
        }
        
        function loadMessages() {
            if (currentUser.role === 'admin' || currentUser.role === 'teacher') {
                loadSentMessages();
            } else if (currentUser.role === 'parent') {
                loadReceivedMessages();
            }
        }
        
        function loadSentMessages() {
            const sentMessagesList = document.getElementById('sentMessagesList');
            if (!sentMessagesList) return;
            
            const userMessages = messages.filter(msg => msg.fromUserId === currentUser.id);
            
            if (userMessages.length === 0) {
                sentMessagesList.innerHTML = '<p class="text-gray-500 text-center py-8">No messages sent yet.</p>';
                return;
            }
            
            sentMessagesList.innerHTML = '';
            userMessages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'border border-gray-200 rounded-lg p-4';
                messageDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-900">${message.subject}</h4>
                        <div class="flex items-center space-x-2">
                            ${message.priority === 'urgent' ? '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">Urgent</span>' : ''}
                            ${message.priority === 'high' ? '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">High</span>' : ''}
                            <span class="text-xs text-gray-500">${message.date.toLocaleDateString()}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">To: ${message.to}</p>
                    <p class="text-gray-700">${message.content}</p>
                `;
                sentMessagesList.appendChild(messageDiv);
            });
        }
        
        function loadReceivedMessages() {
            const receivedMessagesList = document.getElementById('receivedMessagesList');
            if (!receivedMessagesList) return;
            
            // Get messages for parent's child's class or all parents
            const childClass = currentUser.studentClass;
            const relevantMessages = messages.filter(msg => 
                msg.toClass === 'All' || msg.toClass === childClass
            );
            
            if (relevantMessages.length === 0) {
                receivedMessagesList.innerHTML = '<p class="text-gray-500 text-center py-8">No messages received yet.</p>';
                return;
            }
            
            receivedMessagesList.innerHTML = '';
            relevantMessages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'border border-gray-200 rounded-lg p-4';
                messageDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-medium text-gray-900">${message.subject}</h4>
                        <div class="flex items-center space-x-2">
                            ${message.priority === 'urgent' ? '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">Urgent</span>' : ''}
                            ${message.priority === 'high' ? '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full">High</span>' : ''}
                            <span class="text-xs text-gray-500">${message.date.toLocaleDateString()}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">From: ${message.from}</p>
                    <p class="text-gray-700">${message.content}</p>
                `;
                receivedMessagesList.appendChild(messageDiv);
            });
        }
        
        // Homework functions
        function addHomework(event) {
            event.preventDefault();
            
            const subject = document.getElementById('homeworkSubject').value;
            const homeworkClass = document.getElementById('homeworkClass').value;
            const title = document.getElementById('homeworkTitle').value;
            const description = document.getElementById('homeworkDescription').value;
            const dueDate = document.getElementById('homeworkDueDate').value;
            const file = document.getElementById('homeworkFile').files[0];
            
            const newHomework = {
                id: homework.length + 1,
                subject: subject,
                class: homeworkClass,
                title: title,
                description: description,
                dueDate: dueDate,
                createdBy: `${currentUser.firstName} ${currentUser.lastName}`,
                createdById: currentUser.id,
                attachment: file ? file.name : null
            };
            
            homework.push(newHomework);
            showNotification('Homework assignment created successfully!');
            
            // Reset form
            event.target.reset();
            
            // Reload homework list
            loadHomeworkList();
        }
        
        function loadHomeworkList() {
            const homeworkList = document.getElementById('homeworkList');
            if (!homeworkList) return;
            
            let relevantHomework = [];
            if (currentUser.role === 'admin') {
                relevantHomework = homework;
            } else if (currentUser.role === 'teacher') {
                relevantHomework = homework.filter(hw => hw.createdById === currentUser.id);
            }
            
            if (relevantHomework.length === 0) {
                homeworkList.innerHTML = '<p class="text-gray-500 text-center py-8">No homework assignments yet.</p>';
                return;
            }
            
            homeworkList.innerHTML = '';
            relevantHomework.forEach(hw => {
                const hwDiv = document.createElement('div');
                hwDiv.className = 'border border-gray-200 rounded-lg p-4';
                hwDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h4 class="font-medium text-gray-900">${hw.title}</h4>
                            <p class="text-sm text-gray-600">${hw.subject} - ${hw.class}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">Due: ${new Date(hw.dueDate).toLocaleDateString()}</p>
                            <p class="text-xs text-gray-400">By: ${hw.createdBy}</p>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-2">${hw.description}</p>
                    ${hw.attachment ? `<p class="text-sm text-blue-600">ðŸ“Ž ${hw.attachment}</p>` : ''}
                    <div class="mt-3 flex space-x-2">
                        <button onclick="editHomework(${hw.id})" class="text-primary hover:text-blue-700 text-sm">Edit</button>
                        <button onclick="deleteHomework(${hw.id})" class="text-danger hover:text-red-700 text-sm">Delete</button>
                    </div>
                `;
                homeworkList.appendChild(hwDiv);
            });
        }
        
        function editHomework(id) {
            showNotification('Edit functionality would be implemented here.');
        }
        
        function deleteHomework(id) {
            homework = homework.filter(hw => hw.id !== id);
            loadHomeworkList();
            showNotification('Homework assignment deleted successfully!');
        }
        
        // Fee management functions
        function addFeeStructure(event) {
            event.preventDefault();
            
            const type = document.getElementById('feeType').value;
            const amount = parseInt(document.getElementById('feeAmount').value);
            
            const newFee = {
                id: feeStructure.length + 1,
                type: type,
                amount: amount
            };
            
            feeStructure.push(newFee);
            showNotification('Fee type added successfully!');
            
            // Reset form
            event.target.reset();
            
            // Reload fee structure
            loadFeeStructure();
            loadStudentFees();
        }
        
        function loadFeeStructure() {
            const tbody = document.getElementById('feeStructureTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            feeStructure.forEach(fee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${fee.type}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ksh ${fee.amount.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="deleteFeeType(${fee.id})" class="text-danger hover:text-red-700">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function deleteFeeType(id) {
            feeStructure = feeStructure.filter(fee => fee.id !== id);
            loadFeeStructure();
            showNotification('Fee type deleted successfully!');
        }
        
        function loadStudentFees() {
            const tbody = document.getElementById('studentFeesTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            students.forEach(student => {
                const studentFee = studentFees.find(sf => sf.studentId === student.id) || {
                    totalFees: feeStructure.reduce((sum, fee) => sum + fee.amount, 0),
                    paidAmount: 0,
                    balance: feeStructure.reduce((sum, fee) => sum + fee.amount, 0)
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.class}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Ksh ${studentFee.totalFees.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-success">Ksh ${studentFee.paidAmount.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${studentFee.balance > 0 ? 'text-danger' : 'text-success'}">Ksh ${studentFee.balance.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="recordPayment(${student.id})" class="text-primary hover:text-blue-700 mr-3">Record Payment</button>
                        <button onclick="viewPaymentHistory(${student.id})" class="text-secondary hover:text-yellow-700">History</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function recordPayment(studentId) {
            const amount = prompt('Enter payment amount (Ksh):');
            if (amount && !isNaN(amount)) {
                const paymentAmount = parseInt(amount);
                let studentFee = studentFees.find(sf => sf.studentId === studentId);
                
                if (!studentFee) {
                    studentFee = {
                        studentId: studentId,
                        totalFees: feeStructure.reduce((sum, fee) => sum + fee.amount, 0),
                        paidAmount: 0,
                        balance: feeStructure.reduce((sum, fee) => sum + fee.amount, 0),
                        payments: []
                    };
                    studentFees.push(studentFee);
                }
                
                studentFee.paidAmount += paymentAmount;
                studentFee.balance = studentFee.totalFees - studentFee.paidAmount;
                studentFee.payments.push({
                    amount: paymentAmount,
                    date: new Date().toISOString().split('T')[0],
                    type: 'Payment'
                });
                
                loadStudentFees();
                showNotification(`Payment of Ksh ${paymentAmount.toLocaleString()} recorded successfully!`);
            }
        }
        
        function viewPaymentHistory(studentId) {
            const student = students.find(s => s.id === studentId);
            const studentFee = studentFees.find(sf => sf.studentId === studentId);
            
            if (studentFee && studentFee.payments.length > 0) {
                let history = `Payment History for ${student.name}:\n\n`;
                studentFee.payments.forEach(payment => {
                    history += `${payment.date}: Ksh ${payment.amount.toLocaleString()} (${payment.type})\n`;
                });
                alert(history);
            } else {
                alert(`No payment history found for ${student.name}.`);
            }
        }
        
        function searchStudentFees() {
            const searchTerm = document.getElementById('feeSearchStudent').value.toLowerCase();
            const rows = document.querySelectorAll('#studentFeesTableBody tr');
            
            rows.forEach(row => {
                const studentName = row.cells[0].textContent.toLowerCase();
                if (studentName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Attendance functions
        function loadStudentsForAttendance() {
            const selectedClass = document.getElementById('attendanceClass').value;
            const studentsList = document.getElementById('attendanceStudentsList');
            
            if (!selectedClass) {
                studentsList.innerHTML = '';
                return;
            }
            
            const classStudents = students.filter(student => student.class === selectedClass);
            
            if (classStudents.length === 0) {
                studentsList.innerHTML = '<p class="text-gray-500 text-center py-4">No students found in this class.</p>';
                return;
            }
            
            studentsList.innerHTML = '';
            classStudents.forEach(student => {
                const studentDiv = document.createElement('div');
                studentDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                studentDiv.innerHTML = `
                    <span class="font-medium text-gray-900">${student.name}</span>
                    <div class="flex space-x-4">
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="present" class="mr-2" checked>
                            <span class="text-success">Present</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="attendance_${student.id}" value="absent" class="mr-2">
                            <span class="text-danger">Absent</span>
                        </label>
                    </div>
                `;
                studentsList.appendChild(studentDiv);
            });
        }
        
        function markAllPresent() {
            const presentRadios = document.querySelectorAll('input[value="present"]');
            presentRadios.forEach(radio => {
                radio.checked = true;
            });
            showNotification('All students marked as present!');
        }
        
        function saveAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const selectedClass = document.getElementById('attendanceClass').value;
            
            if (!date || !selectedClass) {
                showNotification('Please select date and class!', 'error');
                return;
            }
            
            const classStudents = students.filter(student => student.class === selectedClass);
            let savedCount = 0;
            
            classStudents.forEach(student => {
                const attendanceRadio = document.querySelector(`input[name="attendance_${student.id}"]:checked`);
                if (attendanceRadio) {
                    // Remove existing attendance for this date and student
                    attendance = attendance.filter(att => !(att.studentId === student.id && att.date === date));
                    
                    // Add new attendance record
                    attendance.push({
                        studentId: student.id,
                        date: date,
                        status: attendanceRadio.value
                    });
                    savedCount++;
                }
            });
            
            updateAttendanceStats();
            showNotification(`Attendance saved for ${savedCount} students!`);
        }
        
        function updateAttendanceStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance.filter(att => att.date === today);
            
            const totalStudents = students.length;
            const presentToday = todayAttendance.filter(att => att.status === 'present').length;
            const absentToday = todayAttendance.filter(att => att.status === 'absent').length;
            const attendanceRate = totalStudents > 0 ? Math.round((presentToday / totalStudents) * 100) : 0;
            
            document.getElementById('totalStudentsCount').textContent = totalStudents;
            document.getElementById('presentTodayCount').textContent = presentToday;
            document.getElementById('absentTodayCount').textContent = absentToday;
            document.getElementById('attendancePercentage').textContent = attendanceRate + '%';
        }

        // Navigation functions
        function showSection(sectionName) {
            // Route parent-specific sections
            if (currentUser && currentUser.role === 'parent') {
                if (sectionName === 'homework') {
                    sectionName = 'parent-homework';
                } else if (sectionName === 'fees') {
                    sectionName = 'parent-fees';
                }
            }
            
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('fade-in');
            }
            
            // Update navigation buttons
            const navButtons = document.querySelectorAll('.nav-btn, .nav-btn-mobile');
            navButtons.forEach(btn => {
                btn.classList.remove('text-primary', 'bg-primary', 'text-white');
                btn.classList.add('text-gray-700');
            });
            
            // Highlight active button
            const activeButtons = document.querySelectorAll(`[onclick*="showSection('${sectionName.replace('parent-', '')}')"]`);
            activeButtons.forEach(btn => {
                btn.classList.remove('text-gray-700');
                btn.classList.add('text-primary');
            });
            
            // Load section-specific data
            setTimeout(() => {
                if (sectionName === 'students') {
                    updateStudentsTable();
                } else if (sectionName === 'homework') {
                    loadHomeworkList();
                } else if (sectionName === 'fees') {
                    loadFeeStructure();
                    loadStudentFees();
                } else if (sectionName === 'attendance') {
                    // Set today's date by default
                    const today = new Date().toISOString().split('T')[0];
                    const dateInput = document.getElementById('attendanceDate');
                    if (dateInput) {
                        dateInput.value = today;
                    }
                    updateAttendanceStats();
                } else if (sectionName === 'messaging') {
                    loadMessages();
                }
            }, 100);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date for attendance by default
            const today = new Date().toISOString().split('T')[0];
            const attendanceDateInput = document.getElementById('attendanceDate');
            if (attendanceDateInput) {
                attendanceDateInput.value = today;
            }
            
            // Initialize all data when page loads
            initializeApp();
        });
        
        function initializeApp() {
            // Ensure all sections are properly initialized
            updateStudentsTable();
            loadFeeStructure();
            loadStudentFees();
            updateAttendanceStats();
            
            // Set up event listeners for dynamic content
            setupEventListeners();
        }
        
        function setupEventListeners() {
            // Add event listeners for forms that might not exist yet
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                if (!form.hasAttribute('data-listener-added')) {
                    form.setAttribute('data-listener-added', 'true');
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'978c352370758a61',t:'MTc1NjgwNzcyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
